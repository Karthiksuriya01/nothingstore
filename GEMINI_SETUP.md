# Google Gemini AI Price Comparison Setup

## Overview

The app includes AI-powered price comparison using Google Gemini. On the product detail page, users can see estimated prices on Amazon, Flipkart, and Blinkit.

## How It Works

1. User visits a product detail page
2. The app automatically calls the Gemini API to get market prices
3. Estimated prices are shown for each platform with discount percentages
4. Results are cached and updated when navigating to different products

## Setup Instructions

### Step 1: Get a Google Gemini API Key

1. Visit [Google AI Studio](https://aistudio.google.com/app/apikey)
2. Click **"Create API Key"** button
3. Select or create a project
4. Click **"Create API Key in new Google Cloud project"** or **"Create API Key"**
5. Copy your API key (it starts with `AIza...`)

### Step 2: Add to Your Project

Create a `.env.local` file in your project root:

```env
GOOGLE_GENERATIVE_AI_API_KEY=your_api_key_here
```

Replace `your_api_key_here` with your actual API key.

**Important:** Never commit `.env.local` to version control. It's listed in `.gitignore`.

### Step 3: Verify It Works

1. Start the development server: `pnpm dev`
2. Navigate to any product detail page
3. You should see a "Market Prices" section loading
4. After a moment, prices for Amazon, Flipkart, and Blinkit should appear

## API Endpoint

### Route: `/api/compare-prices`

**Method:** POST

**Headers:**
```
Content-Type: application/json
```

**Request Body:**
```json
{
  "productName": "Smart Watch Series 5",
  "basePrice": 299.99
}
```

**Response:**
```json
{
  "productName": "Smart Watch Series 5",
  "basePrice": 299.99,
  "marketPrices": {
    "amazon": {
      "price": 289.99,
      "discount": 15
    },
    "flipkart": {
      "price": 279.99,
      "discount": 20
    },
    "blinkit": {
      "price": 0,
      "discount": 0
    }
  }
}
```

**Notes:**
- Price is in USD
- Discount is in percentage
- If price is 0, the product is not typically available on that platform
- Response is generated by Gemini based on market research data

## API Usage

### Making Requests from Frontend

```typescript
const response = await fetch('/api/compare-prices', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    productName: 'Smart Watch Series 5',
    basePrice: 299.99
  })
});

const data = await response.json();
console.log(data.marketPrices);
```

### Error Handling

The API returns error responses if:
- Product name or price is missing
- API key is not configured
- Gemini API fails or times out

Errors include descriptive messages in the response.

## Pricing

Google's Generative AI API is **free** for testing:
- 15 requests per minute for free tier
- Unlimited requests with paid billing

For production use, consider:
1. Upgrading to Google Cloud paid plan
2. Implementing caching to reduce API calls
3. Limiting price comparison requests to specific times

## Customizing the Prompt

Edit `/app/api/compare-prices/route.ts` to change:
- Platforms checked (Amazon, Flipkart, Blinkit)
- Price estimation logic
- Response format

Current prompt:
```typescript
const prompt = `Based on typical market prices for "${productName}", provide estimated prices on these platforms:
    
Please respond in JSON format only, with no additional text:
{
  "amazon": { "price": number, "discount": number },
  "flipkart": { "price": number, "discount": number },
  "blinkit": { "price": number, "discount": number }
}

Where price is in USD and discount is percentage. Prices should be realistic estimates for this product. If product is not typically available on a platform, use 0.`;
```

## Troubleshooting

### Price comparison not loading

**Error:** "Failed to compare prices"

**Solutions:**
1. Check `.env.local` has correct API key
2. Restart development server after adding `.env.local`
3. Check browser console for detailed error messages
4. Verify API key is active (check Google Cloud console)

### "API key not configured"

**Solutions:**
1. Create `.env.local` in project root
2. Add: `GOOGLE_GENERATIVE_AI_API_KEY=your_key`
3. Restart the development server
4. Refresh the browser

### Slow price loading

**Solutions:**
1. Gemini API takes 2-5 seconds per request
2. Consider caching results in the database
3. Show skeleton loader while waiting (already implemented)
4. Pre-fetch prices in background

### Inconsistent prices

**Note:** Gemini estimates based on general market knowledge. Prices may vary:
- By location/region
- Based on current market conditions
- Due to API's knowledge cutoff
- When products are new/rare

For accurate real-time prices, integrate actual e-commerce APIs (Amazon PA API, Flipkart API, etc.)

## Rate Limiting

Current setup has no rate limiting. Consider adding for production:

```typescript
// Simple rate limiter example
const rateLimiter = new Map();

const isRateLimited = (ip: string) => {
  const lastRequest = rateLimiter.get(ip);
  if (!lastRequest || Date.now() - lastRequest > 60000) {
    rateLimiter.set(ip, Date.now());
    return false;
  }
  return true;
};
```

## Cost Optimization

### Caching Responses

Add caching to avoid repeated API calls:

```typescript
const cache = new Map();

const getCachedPrices = (productName: string) => {
  const cached = cache.get(productName);
  if (cached && Date.now() - cached.timestamp < 3600000) {
    return cached.data;
  }
  return null;
};
```

### Batch Processing

Send multiple products at once:

```json
{
  "products": [
    { "name": "Product 1", "price": 100 },
    { "name": "Product 2", "price": 200 }
  ]
}
```

## Production Deployment

When deploying to production:

1. **Set environment variable on deployment platform:**
   - Vercel: Settings → Environment Variables
   - Other platforms: Set `GOOGLE_GENERATIVE_AI_API_KEY`

2. **Monitor API usage:**
   - Check Google Cloud Console
   - Set up billing alerts
   - Track API costs

3. **Implement caching:**
   - Use Redis for temporary cache
   - Cache prices for 1-24 hours
   - Reduce API calls by 90%

4. **Add fallbacks:**
   - Show default/cached prices if API fails
   - Don't break user experience on API errors

## Advanced Usage

### Adding More Platforms

Edit the API route to add more e-commerce platforms:

```typescript
const prompt = `Based on typical market prices for "${productName}", provide estimated prices on these platforms:
Amazon, Flipkart, Blinkit, eBay, AliExpress

Please respond in JSON format only...`;
```

### Using Different Gemini Models

Current model: `gemini-1.5-flash` (fast and free)

Other options:
- `gemini-pro` - More capable, slightly slower
- `gemini-1.5-pro` - Most capable, for complex tasks

Change in `/app/api/compare-prices/route.ts`:
```typescript
const model = genAI.getGenerativeModel({ model: 'gemini-pro' });
```

### Streaming Responses

For real-time price updates:

```typescript
const result = await model.generateContentStream(prompt);

for await (const chunk of result.stream) {
  // Process streaming data
}
```

## Security

### API Key Protection

- Never expose API key in frontend code
- Always call via backend API route
- Current setup is secure ✓

### Input Validation

Add validation to prevent misuse:

```typescript
if (!productName || productName.length > 100) {
  return NextResponse.json(
    { error: 'Invalid product name' },
    { status: 400 }
  );
}
```

## Additional Resources

- [Google Gemini API Docs](https://ai.google.dev/docs)
- [Google AI Studio](https://aistudio.google.com)
- [Prompt Engineering Guide](https://ai.google.dev/tutorials/python_quickstart)
- [API Pricing](https://ai.google.dev/pricing)

## Support

For issues:
1. Check Google Cloud Console logs
2. Test API key in Google AI Studio
3. Verify request format matches documentation
4. Check browser console for error details
